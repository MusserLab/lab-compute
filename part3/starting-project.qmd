# Starting a New Analysis Project

This chapter walks through setting up a new analysis project from scratch, using all the tools together. For detailed explanations of each convention, see the [Project Organization](../part2/project-organization.qmd) and [Quarto](../part2/quarto.qmd) chapters.

## The Standard Structure

Every analysis project should have:

```
project-name/
├── .claude/
│   └── CLAUDE.md         # Claude Code instructions
├── .git/                  # Git repository
├── .gitignore            # Files to exclude from Git
├── R/                    # Shared R helper functions
├── python/               # Shared Python helper functions
├── scripts/
│   └── exploratory/      # One-off analyses
├── data/                 # External inputs only — scripts never write here
├── outs/                 # All script-generated outputs
├── environment.yml       # Conda environment (Python)
├── renv.lock            # R package versions
└── README.md            # Project description
```

For projects with multiple analysis sections (e.g., phosphoproteomics + transcriptomics), mirror the sections across `scripts/`, `data/`, and `outs/`:

```
scripts/
├── phosphoproteomics/
│   ├── 01_qc.qmd
│   └── 02_analysis.qmd
├── transcriptomics/
│   └── 01_heatmaps.qmd
└── exploratory/

data/
├── phosphoproteomics/
└── transcriptomics/

outs/
├── phosphoproteomics/
├── transcriptomics/
└── exploratory/
```

## Step-by-Step Setup

### 1. Create the Project Directory

```bash
mkdir my-analysis
cd my-analysis
```

### 2. Initialize Git

```bash
git init
```

Create `.gitignore`:

```
# Generated outputs (reproducible from code)
outs/

# R artifacts
.Rhistory
.RData
.Rproj.user/
renv/library/
renv/staging/
renv/local/
*_cache/

# Python artifacts
__pycache__/
*.py[cod]
*.egg-info/
.eggs/
*.egg
.venv/
venv/

# Quarto rendering
*_files/
.quarto/

# OS files
.DS_Store
Thumbs.db

# IDE settings
.vscode/
.positron/
*.Rproj

# Secrets
.env
*.pem
credentials.json
```

### 3. Create Directory Structure

```bash
mkdir -p R python scripts/exploratory data outs/exploratory .claude
```

::: {.callout-claude title="Ask Claude"}
**Set up your CLAUDE.md:**

> I'm starting a new project analyzing proteomics data from cell cultures. The data is in `data/`, I'm using R with renv, and I'll render with Quarto. Can you create a starter `.claude/CLAUDE.md` for this project?

*Tell Claude the project type, data location, and tools you're using. It'll create a tailored template.*
:::

### 4. Set Up Python Environment (if using Python)

```bash
conda create -n my-analysis python=3.11 pandas numpy matplotlib seaborn ipykernel -y
conda activate my-analysis
pip install session-info
conda env export --from-history > environment.yml
```

The `--from-history` flag produces a portable file with only explicitly installed packages (no platform-specific builds).

::: {.callout-note}
Always include `ipykernel` — it's required for Quarto to render Python `.qmd` files. Include `session-info` for reproducibility tracking.
:::

### 5. Set Up R with renv (if using R)

In R:

```r
renv::init()
install.packages(c("tidyverse", "here"))
renv::snapshot()
```

### 6. Create Project CLAUDE.md

Create `.claude/CLAUDE.md`:

```markdown
# Project: My Analysis

## Overview
[Brief description of what this project does]

## Environment
- Python: `conda activate my-analysis`
- R: Uses renv (auto-activates)

## Key Directories
- `data/` — External input data (read-only, scripts never write here)
- `scripts/` — Quarto analysis scripts (.qmd)
- `scripts/exploratory/` — One-off analyses
- `outs/` — All script-generated outputs
- `R/` — Shared R helper functions
- `python/` — Shared Python helper functions

## Workflows
[How to run the analysis]

## Data
[Description of data files and their sources]

## Conventions
- Scripts use `status:` lifecycle field (development → finalized → deprecated)
- Every script writes `BUILD_INFO.txt` to its output folder
- Scripts communicate through files in `outs/`, not shared memory
- Cross-language data uses Parquet format

## Project Document Registry
[Planning documents go here as the project grows]
```

### 7. Create README

Create `README.md`:

```markdown
# My Analysis

## Overview
[What this project does]

## Setup

### Python
conda env create -f environment.yml
conda activate my-analysis

### R
# renv will auto-activate; run renv::restore() if needed

## Running the Analysis
[Instructions]

## Data
[Data sources and descriptions]
```

### 8. First Commit

```bash
git add .
git commit -m "Initial project setup"
```

### 9. Push to GitHub

```bash
gh repo create my-analysis --private --source=. --push
```

Or manually:

1. Create repo on GitHub
2. `git remote add origin https://github.com/USERNAME/my-analysis.git`
3. `git push -u origin main`

## Adding Data

Put external data files in `data/`. Never modify these files — treat them as read-only. Scripts never write to `data/`.

If data files are large, don't commit them to Git. Add them to `.gitignore` and document where to obtain the data in your README.

## Writing Your First Script

Analysis scripts are `.qmd` files (not `.R` or `.py`). Here's a typical first script that reads external data, cleans it, and saves the result to `outs/`:

```r
# scripts/01_clean_data.qmd — setup chunk

library(tidyverse)
library(here)

dir_out <- here("outs", "01_clean_data")
dir.create(dir_out, recursive = TRUE, showWarnings = FALSE)

# --- Inputs (external data) ---
raw <- read_csv(here("data", "experiment_data.csv"))
cat("Loaded", nrow(raw), "rows\n")

# Clean
clean <- raw %>%
  filter(!is.na(value)) %>%
  filter(quality > 0.8)
cat("After cleaning:", nrow(clean), "rows\n")

# Save to outs/
write_csv(clean, file.path(dir_out, "clean_data.csv"))
```

Key points:

- Reads from `data/` (external inputs)
- Writes to `outs/01_clean_data/` (script-specific output folder)
- Never writes to `data/`

For full script templates including YAML headers, setup chunks, and BUILD_INFO.txt, see the [Quarto](../part2/quarto.qmd) chapter and [Templates](../appendices/templates.qmd) appendix.

## Using Claude Code

With your `.claude/CLAUDE.md` in place, start Claude Code:

```bash
claude
```

Example workflow:

> "I have RNA-seq counts in data/counts.csv. Create a QMD script to load it, do basic QC, and save a cleaned version to outs/."

Review the generated code, then:

> "Commit this with an appropriate message"

## Checklist

Before starting analysis:

- [ ] Git initialized
- [ ] `.gitignore` in place
- [ ] Directory structure created (`R/`, `python/`, `scripts/exploratory/`, `data/`, `outs/`)
- [ ] Conda environment created and exported (`--from-history`)
- [ ] renv initialized (if using R)
- [ ] `.claude/CLAUDE.md` written
- [ ] README drafted
- [ ] First commit made
- [ ] Pushed to GitHub